---
title: "Introduction to R (instructor copy)"
author: "Rebecca Barter"
date: "11/12/2021"
output: html_document
---


In this tutorial, you will learn the basics of R Markdown, data frames (tibbles), piping, data manipulations (select, filter, mutate, etc), and if there's time, visualization using ggplot2. Much of this is nested under the "tidyverse" R package suite.


## Data as data frames

### Load data from web 

```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
gapminder <- read.csv(
    "https://raw.githubusercontent.com/swcarpentry/r-novice-gapminder/gh-pages/_episodes_rmd/data/gapminder-FiveYearData.csv"
)
```

### Head

```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
head(gapminder)
```

### Dimension

```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
dim(gapminder)
```


## The tidyverse

```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
library(tidyverse)
```

## Piping

### %>% "and then"


```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
gapminder %>% head()
```

### Chain together functions

```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
gapminder %>% head() %>% dim()
```



```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
dim(head(gapminder))
```


## Manipulating data with dplyr functions




### Load the tidyverse

```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
library(tidyverse)
```

### Select


```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
gapminder %>% 
  select(country) %>%
  head()
```


### Saving objects

```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
top_six_countries <- gapminder %>%
  select(country) %>%
  head
```

```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
top_six_countries
```


### Filter


```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
gapminder %>%
  filter(country == "Australia")
```

#### Multiple filters

```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
gapminder %>%
  filter(country == "Australia", year > 1980)
```


### Mutate


```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
gapminder %>%
  mutate(gdp = gdpPercap * pop) %>%
  head
```


### Summarize

```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
gapminder %>%
  summarize(mean(lifeExp))
```

#### Naming summary columns

```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
gapminder %>%
  summarize(mean_lifeExp = mean(lifeExp))
```



### Group by

```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
gapminder %>%
  group_by(country) %>%
  summarize(mean_lifeExp = mean(lifeExp)) %>%
  ungroup()
```




## Visualization with ggplot2

### ggplot function


```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
gapminder %>%
  ggplot()
```

### Geom layers


```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE, error=TRUE}
gapminder %>%
  ggplot() +
  geom_point()
```

#### Aesthetics

```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
gapminder %>%
  ggplot() +
  geom_point(aes(x = gdpPercap, y = lifeExp))
```

#### Color


```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
gapminder %>%
  ggplot() +
  geom_point(aes(x = gdpPercap, y = lifeExp, col = continent))
```

### Combining data manipulations and ggplot2


```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
gapminder %>%
  filter(year == 2007) %>%
  ggplot() +
  geom_point(aes(x = gdpPercap, y = lifeExp, col = continent))
```


#### Exercise: create a line plot of global average life expectency over time

```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
gapminder %>%
  group_by(year) %>%
  summarise(mean_lifeExp = mean(lifeExp)) %>%
  ungroup() %>%
  ggplot() +
  geom_line(aes(x = year, y = mean_lifeExp))
```

### Other geoms: lines

```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
gapminder %>%
  ggplot() +
  geom_line(aes(x = year, y = lifeExp, group = country, col = continent))
```

### Multiple geoms

```{r, out.height = "30%", out.width = "30%", message = FALSE, warning = FALSE}
gapminder %>%
  ggplot() +
  geom_line(aes(x = year, y = lifeExp, group = country, col = continent)) +
  geom_point(aes(x = year, y = lifeExp, col = continent))
```

